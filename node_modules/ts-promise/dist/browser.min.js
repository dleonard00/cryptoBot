!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.tsPromise=t()}}(function(){return function t(e,r,i){function n(s,u){if(!r[s]){if(!e[s]){var c="function"==typeof require&&require;if(!u&&c)return c(s,!0);if(o)return o(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var h=r[s]={exports:{}};e[s][0].call(h.exports,function(t){var r=e[s][1][t];return n(r?r:t)},h,h.exports,t,e,r,i)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)n(i[s]);return n}({1:[function(t,e,r){"use strict";var i=this&&this.a||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(r,"__esModule",{value:!0});var n=function(t){function e(e,r){var i=this.constructor,n=t.call(this,r)||this,o=!1;if(n.constructor!==i&&(Object.setPrototypeOf&&Object.setPrototypeOf(n,i.prototype),o=!0),"stack"in n||(o=!0),n.name=e,o)if(Error.captureStackTrace)Error.captureStackTrace(n,i);else{var s=new Error(r);s.name=e;try{throw s}catch(t){n.stack=t.stack||String(t)}}return n}return i(e,t),e}(Error);r.default=n},{}],2:[function(t,e,r){"use strict";function i(t,e){}function n(){}function o(t){return t}var s=this&&this.a||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(r,"__esModule",{value:!0});var u=t("./async"),c=t("./util"),f=t("./Trace"),h=t("./BaseError"),a=function(t){function e(e,r){var i=t.call(this,"UnhandledRejectionError","unhandled rejection: "+e)||this;i.reason=e,i.trace=r;var n=i.reason&&"object"==typeof i.reason&&i.reason.stack;return"string"!=typeof n&&(n=String(e)),i.stack="UnhandledRejectionError: "+n,i}return s(e,t),e}(h.default);r.UnhandledRejectionError=a;var l,p=void 0,d=!1;!function(t){t[t.Pending=0]="Pending",t[t.Fulfilled=1]="Fulfilled",t[t.Rejected=2]="Rejected"}(l||(l={})),i(void 0,void 0);var v={error:void 0},y=new f.default,w=void 0,m=0,Promise=function(){function Promise(t){var e=this;if(this.b=m++,this.c=0,this.d=void 0,this.e=void 0,this.f=void 0,p&&p(this,"construct"),d&&(this.f=new f.default(Promise),w&&this.g(w)),t!==i){if("function"!=typeof t)throw new TypeError("Promise resolver is not a function");var r=!1;try{t(function(t){r||(r=!0,e.h(t))},function(t){r||(r=!0,e.i(o(t)))})}catch(t){r||(r=!0,this.i(o(t)))}}}return Promise.prototype.then=function(t,e){if(p&&p(this,"then("+typeof t+", "+typeof e+")"),1===this.c&&"function"!=typeof t||2===this.c&&"function"!=typeof e)return this;var r=new(Object.getPrototypeOf(this).constructor)(i);return r.g(this),this.j(t,e,r,void 0),r},Promise.prototype.done=function(t,e){if(p&&p(this,"done("+typeof t+", "+typeof e+")"),1!==this.c||"function"==typeof t){var r=y;d&&(r=new f.default,this.f&&r.setSource(this.f)),this.j(t,e,void 0,r)}},Promise.prototype.catch=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(1===arguments.length){var r=arguments[0];return this.then(void 0,r)}var i=arguments[0],n=arguments[1];return this.then(void 0,function(t){var e=!1;if("function"==typeof i)e=i.prototype instanceof Error||i===Error?t instanceof i:i(t);else{if(!Array.isArray(i))throw new TypeError("invalid predicate to .catch(), got "+typeof i);for(var r=0;r<i.length;r++)if(t instanceof i[r]){e=!0;break}}return e?n(t):Promise.reject(t)})},Promise.prototype.finally=function(t){var e=this,r=function(){return t(e)};return this.then(r,r).return(this)},Promise.prototype.isFulfilled=function(){return 1===this.c},Promise.prototype.isRejected=function(){return 2===this.c},Promise.prototype.isPending=function(){return 0===this.c},Promise.prototype.value=function(){if(!this.isFulfilled())throw new Error("Promise is not fulfilled");return this.d},Promise.prototype.reason=function(){if(!this.isRejected())throw new Error("Promise is not rejected");return this.d},Promise.prototype.inspect=function(){return this.toString()},Promise.prototype.toString=function(){var t;switch(this.c){case 0:t="pending";break;case 1:t="fulfilled";break;case 2:t="rejected";break;default:t="unknown"}return"[Promise "+this.b+": "+t+"]"},Promise.prototype.delay=function(t){return this.then(function(e){return new Promise(function(r){setTimeout(function(){return r(e)},t)})})},Promise.prototype.return=function(t){return void 0===t?this.then(n):this.then(function(){return t})},Promise.prototype.throw=function(t){return this.then(function(){return Promise.reject(t)})},Promise.resolve=function(t){var e=new Promise(i);return e.h(t),e},Promise.reject=function(t){var e=new Promise(i);return e.i(t),e},Promise.all=function(t){return new Promise(function(e,r){function i(t,i){var s=t instanceof Promise?t:Promise.resolve(t);s.done(function(t){n[i]=t,o--,0===o&&e(n)},function(t){return r(t)})}if(c.assert(Array.isArray(t),"thenables must be an Array"),0===t.length)return void e([]);for(var n=new Array(t.length),o=t.length,s=0;s<t.length;s++)i(t[s],s)})},Promise.race=function(t){return new Promise(function(e,r){c.assert(Array.isArray(t),"thenables must be an Array");for(var i=0;i<t.length;i++){var n=t[i],o=n instanceof Promise?n:Promise.resolve(n);Promise.resolve(o).done(e,r)}})},Promise.defer=function(){var t,e,r=new Promise(function(r,i){t=r,e=i});return{promise:r,reject:e,resolve:t}},Promise.delay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(void 0===arguments[1]){var r=arguments[0];return new Promise(function(t){setTimeout(t,r)})}return Promise.resolve(arguments[0]).delay(arguments[1])},Promise.setLongTraces=function(t){d=t},Promise.setTracer=function(t){p="function"==typeof t?t:void 0},Promise.flush=function(){u.default.flush()},Promise.prototype.g=function(t){this.f&&t.f&&this.f.setSource(t.f)},Promise.prototype.h=function(t){if(c.assert(0===this.c),!t)return void this.k(t);if(this===t)return void this.i(new TypeError("cannot resolve Promise to self"));if(t instanceof Promise)return t.g(this),void(0===t.c?this.l(t):1===t.c?this.k(t.d):this.i(t.d));if("object"==typeof t||"function"==typeof t){var e=this.m(t);if(e===v)return void this.i(o(v.error));if("function"==typeof e)return void this.n(t,e)}this.k(t)},Promise.prototype.m=function(t){try{var e=t.then;return e}catch(t){return v.error=t,v}},Promise.prototype.k=function(t){c.assert(0===this.c),p&&p(this,"_fulfill("+typeof t+")"),this.c=1,this.d=t,this.o()},Promise.prototype.i=function(t){var e=this;if(c.assert(0===this.c),p&&p(this,"_reject("+t+")"),this.c=2,this.d=t,this.f&&this.d instanceof Error&&!this.d.trace){this.d.trace=this.f;var r=this.d.stack;r&&Object.defineProperty(this.d,"stack",{enumerable:!1,get:function(){return r+"\n  from Promise at:\n"+e.f.inspect()}})}this.o()},Promise.prototype.l=function(t){c.assert(0===this.c),p&&p(this,"_follow([Promise "+t.b+"])"),t.j(void 0,void 0,this,void 0)},Promise.prototype.n=function(t,e){var r=this;c.assert(0===this.c),p&&p(this,"_follow([Thenable])");var i=!1;try{e.call(t,function(t){i||(i=!0,r.h(t))},function(t){i||(i=!0,r.i(o(t)))})}catch(t){i||(i=!0,this.i(o(t)))}},Promise.prototype.j=function(t,e,r,i){var n={promise:this,onFulfilled:t,onRejected:e,slave:r,done:i};if(0!==this.c)u.default.enqueue(Promise.p,n);else if(this.e){var o=this.e.length;this.e[o]=n}else this.e=[n]},Promise.prototype.o=function(){if(this.e){var t=0,e=this.e,r=e.length;for(this.e=void 0;t<r;)u.default.enqueue(Promise.p,e[t++])}},Promise.prototype.q=function(t){var e=1===this.c?t.onFulfilled:t.onRejected;if(t.done){if(p&&p(this,"_unwrap()"),"function"!=typeof e){if(2===this.c){var r=new a(this.d,t.done);throw r}return}c.assert(!w),w=this;try{var i=e(this.d);if(i){var n=i instanceof Promise?i:Promise.resolve(i);n.done()}w=void 0}catch(e){w=void 0;var r=new a(e,t.done);throw r}}else{var s=t.slave;if(p&&p(this,"_unwrap("+s.b+")"),"function"==typeof e){c.assert(!w),w=s;try{s.h(e(this.d))}catch(t){s.i(o(t))}w=void 0}else 1===this.c?s.k(this.d):s.i(this.d)}},Promise.p=function(t){t.promise.q(t)},Promise}();r.Promise=Promise,r.default=Promise},{"./BaseError":1,"./Trace":4,"./async":5,"./util":8}],3:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i="function"==typeof Error.captureStackTrace,n=function(){function t(e){void 0===e&&(e=t),i?Error.captureStackTrace(this,e):this.stack="dummy\n<no trace>"}return t.prototype.inspect=function(){var t=this.stack.split("\n");return t.shift(),t.join("\n")},t}();r.default=n},{}],4:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("./Stack"),n=function(){function t(e){void 0===e&&(e=t),this.stack=new i.default(e)}return t.prototype.setSource=function(e){e.sources?(this.sources=e.sources.concat(e.stack),this.sources.length>t.traceLimit&&(this.sources=this.sources.slice(0,t.traceLimit))):this.sources=[e.stack]},t.prototype.inspect=function(){var t=this.stack.inspect();if(this.sources)for(var e=this.sources.length-1;e>=0;e--)t+="\n  from previous:\n"+this.sources[e].inspect();return t},t.traceLimit=10,t}();r.default=n},{"./Stack":3}],5:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("./util"),n=function(){function t(){this.length=0,this.r=1e3,this.s=0}return t.prototype.push=function(t,e){return this[this.length++]=t,this[this.length++]=e,this.length<this.r},t.prototype.flush=function(){for(;this.s<this.length;){var t=this[this.s],e=this[this.s+1];this[this.s]=this[this.s+1]=void 0,this.s+=2,t(e)}this.length=0,this.s=0},t}(),o=function(){function t(){var t=this;this.t=[],this.u=[new n],this.v=this.u[0],this.w=function(){return t.x()},this.y=!1,this.z=!1,this.A=void 0}return t.prototype.setScheduler=function(t){i.assert(void 0===t||null===t||"function"==typeof t),this.A=t},t.prototype.enqueue=function(t,e){this.y||this.z||this.B(),this.v||(this.v=this.t.pop(),this.v||(this.v=new n),this.u.push(this.v)),this.v.push(t,e)||(this.v=void 0)},t.prototype.flush=function(){i.assert(!this.y,"cannot recursively flush"),this.y=!0;try{for(;;){if(this.u[0].flush(),1===this.u.length){this.v=this.u[0];break}i.assert(this.v!==this.u[0]),this.t.push(this.u.shift())}}finally{this.y=!1,this.u[0].length>0&&!this.z&&this.B()}},t.prototype.B=function(){i.assert(!this.z);var t=this.A;t||(t="function"==typeof setImmediate?setImmediate:setTimeout),t(this.w),this.z=!0},t.prototype.x=function(){this.z=!1,this.flush()},t}();r.Async=o,r.async=new o,r.default=r.async},{"./util":8}],6:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("./Promise");r.default=i.default,r.Promise=i.Promise,r.UnhandledRejectionError=i.UnhandledRejectionError;var n=t("./polyfill");r.polyfill=n.default;var o=t("./BaseError");r.BaseError=o.default},{"./BaseError":1,"./Promise":2,"./polyfill":7}],7:[function(t,e,r){"use strict";function i(t){void 0===t&&(t=!1);var e=o.getGlobal();return!!e&&(t||"function"!=typeof e.Promise?(e.Promise=n.Promise,!0):e.Promise instanceof n.Promise)}Object.defineProperty(r,"__esModule",{value:!0});var n=t("./Promise"),o=t("./util");r.default=i},{"./Promise":2,"./util":8}],8:[function(t,e,r){"use strict";function i(t,e){if(!t)throw new Error(e?"assertion failed: "+e:"assertion failed")}function n(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;var t;try{t=new Function("return this")()}catch(t){}return t}Object.defineProperty(r,"__esModule",{value:!0}),r.assert=i,r.getGlobal=n},{}]},{},[6])(6)});
